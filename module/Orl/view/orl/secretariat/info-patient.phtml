<!-- MES STYLES -->
<?php echo $this->headLink()->appendStylesheet($this->basePath() . '/css/orl/styleUrgence.css'); ?>

<!-- MES JS -->
<?php echo $this->headScript()->appendFile($this->basePath() . '/js/orl/jsOrl.js'); ?>

<?php $Control = new \Orl\View\Helpers\DateHelper(); ?>

<style>
	/*-----D�but style-----*/

	tr:hover

	/* Apparence au survol des lignes */
		{
		/*text-decoration: underline;*/
		background-color: white;

	}

	#aa:hover {
		/*text-decoration: underline;*/
		color: black;
		font-size: 17px;
		cursor: pointer;
	}

	#aa a:hover {
		color: #0f9f3e;
	}

	#aa {
		color: green;
	}

	#aa a {
		color: black;
	}

	#barre {
		/*background-color: #a8a8a8;*/
		padding-bottom: 20px;
		/*Pour s�parer le contenu de la bordure du bas du bloc*/
		magin-bottom: 15px;
		/*Pour s�parer la bordure du prochain �l�ment*/
		border-bottom: 3px solid gray;
		/*Pour faire un trait gris horizontal*/
		margin-left: 165px;
	}

	#numero {
		/*background-color: #a8a8a8;*/
		width: 480px;
		margin-left: 140px;
		font-family: police4;
		font-size: 19px;
		color: green;
	}

	#contenu table td {
		vertical-align: top;
	}

	#contenu table td p {
		margin-right: 15px;
		max-height: 44px;
		max-width: 90%;
		overflow: auto;
	}

	#contenu {
		visibility: hidden
	}

	;
	/*----fin style--------*/
</style>
<script type="text/javascript">
	$(window).load(function() {
		$('#wait').toggle(false);
		$('#contenu').fadeIn().css({
			'visibility': 'visible'
		});

		$('.accordion-menu, .profil-secretariat-menu').toggle(true);
		$('#profil-secretariat-menu-rubrique-dossier-patient  .submenuItems #liste-patient-select, #profil-secretariat-menu-rubrique-dossier-patient .submenuItems #liste-patient-select > i').css({
			'font-weight': 'bold',
			'color': 'black'
		});

		$('#profil-secretariat-menu-rubrique-dossier-patient div').trigger('dblclick');
	});
</script>


<div id="titre" style='font-family: police2; text-decoration:none; color: rgb(24, 153, 121); font-size: 20px; font-weight: bold; padding-left: 20px;'>
	<i class="icon-folder-open" style="padding-top: 3px;"></i> &nbsp; ETAT CIVIL DU PATIENT
</div>
<div id="wait" style="color: gray; font-size: 20px; text-align: center; margin-top: 80px;"> <span> Chargement ... </span> </div>
<div id="contenu" style='height:370px;'>

	<div style='width: 100%;'>

		<div style="width: 25%; height: 100px; float: left; display: flex; ">
			<img id="photo-patient" class="photo-patient" src="<?php echo $this->basePath() . '/img/photos_patients/' . $this->image; ?>" style="width:125px; height:125px; margin: auto;" />

			<div style='width: 20%; height: 20px; position: absolute; margin-top: 150px; text-align: center; color: rgb(24, 153, 121); font-weight: bold; font-size:22px; font-family: time new romans;'>
				<?php echo $this->lesdetails['PRENOM'] . ' ' . $this->lesdetails['NOM']; ?><br>
				<span style='font-size:22px; font-weight: normal;'> <?php
																	$age = $this->lesdetails['AGE'];
																	$age = gestionAges($age, $this->lesdetails['DATE_NAISSANCE']);
																	echo $age; ?> </span>
			</div>

		</div>

		<div style="width: 75%; background: yello; height: 250px; float: left;">

			<p style='color: white; opacity: 0.09; position: absolute; right: 30;'>
				<img id="photo" src='<?php echo $this->basePath() . '/img/photos_patients/' . $this->image; ?>' style=' width:95px; height:95px;' />
			</p>
			<table style="width: 90%;">
				<tr style="width: 100%;">
					<td style='width:27%; font-family: police1;font-size: 12px;'>
						<div><a style="text-decoration:none; font-size:16px; font-family: cursive; color: gray;">T&eacute;l&eacute;phone</a><br>
							<p style='font-weight:bold; font-size:21px; color: rgb(24, 153, 121);'><?php echo $this->lesdetails['TELEPHONE']; ?> </p>
						</div>
					</td>

					<td style='width:35%; font-family: police1;font-size: 12px;'>
						<div><a style="text-decoration:none; font-size:16px; font-family: cursive; color: gray;">Lieu de naissance</a><br>
							<p style='font-weight:bold; font-size:21px; color: rgb(24, 153, 121);'><?php echo $this->lesdetails['LIEU_NAISSANCE']; ?> </p>
						</div>
					</td>

					<td style='width:38%; font-family: police1;font-size: 12px;'>
						<div><a style="text-decoration:none; font-size:16px; font-family: cursive; color: gray;">@-mail</a><br>
							<p style='font-weight:bold; font-size:21px; color: rgb(24, 153, 121);'><?php echo $this->lesdetails['EMAIL']; ?> </p>
						</div>
					</td>
				</tr>

				<tr>
					<td style=' font-family: police1;font-size: 12px;'>
						<div><a style="text-decoration:none; font-size:16px; font-family: cursive; color: gray;">Date de naissance</a><br>
							<p style='font-weight:bold; font-size:21px; color: rgb(24, 153, 121);'>
								<?php
								$date_naissance = $this->lesdetails['DATE_NAISSANCE'];
								if ($date_naissance) {
									echo $Control->convertDate($this->lesdetails['DATE_NAISSANCE']);
								} else {
									echo "";
								}
								?>
							</p>
						</div>
					</td>

					<td style=' font-family: police1;font-size: 12px;'>
						<div><a style="text-decoration:none; font-size:16px; font-family: cursive; color: gray;">Nationalit&eacute; origine</a><br>
							<p style='font-weight:bold; font-size:21px; color: rgb(24, 153, 121);'><?php echo $this->lesdetails['NATIONALITE_ORIGINE']; ?> </p>
						</div>
					</td>

					<td style=' font-family: police1;font-size: 12px;'>
						<div id="aa"><a style="text-decoration: none; font-size:16px; font-family: cursive; color: gray;">Email</a><br>
							<p style='font-weight: bold;font-size: 19px;'><?php echo $this->lesdetails['EMAIL']; ?></p>
						</div>
					</td>
				</tr>

				<tr>
					<td style=' font-family: police1;font-size: 12px;'>
						<div><a style="text-decoration:none; font-size:16px; font-family: cursive; color: gray;">Sexe</a><br>
							<p style='font-weight:bold; font-size:21px; color: rgb(24, 153, 121);'><?php echo $this->lesdetails['SEXE']; ?> </p>
						</div>
					</td>

					<td style=' font-family: police1;font-size: 12px;'>
						<div><a style="text-decoration:none; font-size:16px; font-family: cursive; color: gray;">Nationalit&eacute; actuelle</a><br>
							<p style='font-weight:bold; font-size:21px; color: rgb(24, 153, 121);'><?php echo $this->lesdetails['NATIONALITE_ACTUELLE']; ?> </p>
						</div>
					</td>

					<td style=' font-family: police1;font-size: 12px;'>
						<div id="aa"><a style="text-decoration: none; font-size:16px; font-family: cursive; color: gray;">Profession</a><br>
							<p style='font-weight: bold;font-size: 19px;'><?php echo $this->lesdetails['PROFESSION']; ?></p>
						</div>
					</td>
				</tr>

				<tr>
					<td colspan="2" style='width: 27%; font-family: police1;font-size: 12px; vertical-align: top;'>
						<div><a style="text-decoration:none; font-size:16px; font-family: cursive; color: gray;">Adresse</a><br>
							<p style='font-weight:bold; font-size:21px; color: rgb(24, 153, 121);'><?php echo $this->lesdetails['ADRESSE']; ?> </p>
						</div>
					</td>

					<td style='width: 195px; font-family: police1;font-size: 12px;'>
					</td>
				</tr>

			</table>

		</div>



		<div style='color: white; opacity: 1; width:95px; height:40px; float:right'>
			<img src='<?php echo $this->basePath() . '/images_icons/fleur1.jpg' ?>' alt="fleur1" />
		</div>
		<table style="margin-left: 25%; padding-top: 5px; width: 80%;">
			<tr>
				<td style="width: 10%;  font-size:16px; font-family: cursive; color: gray; "> Num&eacute;ro dossier : </td>
				<td style="font-weight: bold; width: 13%;  font-family: police1; font-weight:bold; font-size:21px; color: rgb(24, 153, 121);"> <?php echo $this->lesdetails['NUMERO_DOSSIER']; ?></td>
				<td style="font-weight: bold; width: 2%; ">|</td>
				<td style="width: 13%; font-size:16px; font-family: cursive; color: gray;"> Date d'enregistrement : </td>
				<td style="width: 35%; font-weight:bold; font-family: police1; font-size:21px; color: rgb(24, 153, 121);"> <?php echo $Control->convertDateTime($this->date_enregistrement); ?></td>
			</tr>
		</table>

		<div class='block' id='thoughtbot' style=' vertical-align: bottom; padding-left:60%; padding-top: 35px; font-size: 18px; font-weight: bold;'><button id='terminer'>Terminer</button></div>

	</div>

</div>

<script type="text/javascript">
	var base_url = window.location.toString();
	var tabUrl = base_url.split("public");

	$("#terminer").click(function() {
		vart = tabUrl[0] + 'public/secretariat/liste-patient';
		$(location).attr("href", vart);
	});


	//POUR LE MENU GAUCHE dans -elementgauche.phtml
	$('#plus_dossier_patient').toggle(true);
	$("#dossier_patient").replaceWith("<li id='dossier_patient' style='background:#4a5765;'><a href=''><span style='margin-left:0px; color: #ffffff; font-weight:bold; font-size:20px; font-family:Times New Roman;'> <img style='display: inline;' src='" + tabUrl[0] + "public/images_icons/moin-green2.png' alt='Liste' /> Dossier Patient </span></a></li>");
	dep_dossier_patient1();
	$('#liste_dossier_patient_style').css({
		'font-weight': 'bold',
		'color': 'white',
		'font-size': '22px'
	});
</script>













<?php


function nbJours($debut, $fin)
{
	//60 secondes X 60 minutes X 24 heures dans une journee
	$nbSecondes = 60 * 60 * 24;

	$debut_ts = strtotime($debut);
	$fin_ts = strtotime($fin);
	$diff = $fin_ts - $debut_ts;
	return ($diff / $nbSecondes);
}

function gestionAges($age, $date_naissance)
{ //var_dump('eeee'); exit();
	//Gestion des AGE
	if ($age && !$date_naissance) {
		return $age . " ans";
	} else {


		$aujourdhui = (new \DateTime())->format('Y-m-d');
		$age_jours = (int)nbJours($date_naissance, $aujourdhui);

		$age_annees = (int)($age_jours / 365);

		if ($age_annees == 0) {

			if ($age_jours < 31) {
				return $age_jours . " jours";
			} else if ($age_jours >= 31) {

				$nb_mois = (int)($age_jours / 31);
				$nb_jours = $age_jours - ($nb_mois * 31);
				if ($nb_jours == 0) {
					return $nb_mois . "m";
				} else {
					return $nb_mois . "m " . $nb_jours . "j";
				}
			}
		} else {
			$age_jours = $age_jours - ($age_annees * 365);

			if ($age_jours < 31) {

				if ($age_annees == 1) {
					if ($age_jours == 0) {
						return $age_annees . "an";
					} else {
						return $age_annees . "an " . $age_jours . "j";
					}
				} else {
					if ($age_jours == 0) {
						return $age_annees . "ans";
					} else {
						return $age_annees . "ans " . $age_jours . "j";
					}
				}
			} else if ($age_jours >= 31) {

				$nb_mois = (int)($age_jours / 31);
				$nb_jours = $age_jours - ($nb_mois * 31);

				if ($age_annees == 1) {
					if ($nb_jours == 0) {
						return $age_annees . "an " . $nb_mois . "m";
					} else {
						return $age_annees . "an " . $nb_mois . "m ";
					}
				} else {
					if ($nb_jours == 0) {
						return $age_annees . "ans " . $nb_mois . "m";
					} else {
						return $age_annees . "ans " . $nb_mois . "m";
					}
				}
			}
		}
	}
}




?>